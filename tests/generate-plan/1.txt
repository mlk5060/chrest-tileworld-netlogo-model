;==============================
;========== TEST AIM ==========
;==============================
;
; To determine if plan generation is blocked when a CHREST turtle invokes the "generate-plan" procedure when its attention is occupied.
;
;======================================
;========== TEST DESCRIPTION ==========
;======================================
;
; To plan, a CHREST turtle's attention must be free since plan generation involves manipulating information in the visual-spatial field
; and this requires attention. Since a CHREST turtle's attention can be consumed performing visual-spatial field functions, calls to the 
; "generate-plan" procedure may be blocked in certain scenarios to make code execution in the Netlogo model more efficient (why do 
; everything to enable plan generation if the CHREST turtle's attention is consumed and visual-spatial field access is blocked?).  
; Consequently, this test has a CHREST turtle perform a task that consumes its attention before calling "generate-plan" after some 
; time has passed but not enough for the CHREST turle's attention to become "free".
;
;=====================================
;========== TESTS PERFORMED ==========
;=====================================
;
; - The attention-clock of the CHREST turtle should be set to the time taken to completely instantiate the minds eye.
; - The 'construct-visual-spatial-field?' turtle variable should be set to boolean false since the visual-spatial field of the CHREST 
;   turtle will have already been constructed when the first "generate-plan" procedure is invoked.
; - The 'generate-plan' turtle variable is set to 'true' since no *actual* plan generation will occur therefore, no end plan generation 
;   conditions will be met.
; - The length of the 'plan' turtle variable is 0 since no *actual* plan generation will occur.
; - The 'time-spent-deliberating-on-plan' turtle variable is set to 0 since no *actual* plan generation will occur.
; - The 'deliberation-finished-time' is set to 0 since no *actual* plan generation will occur.
; - The 'who-of-tile-last-pushed-in-plan' turtle variable should be set to "" since no plan generation has occured and thus no tile could have been pushed yet.
; - The 'current-search-iteration' turtle variable should be set to 0 since no search has been performed.
;
<test>

	create-chrest-turtles 1 [
		set action-performance-time 10000
		set action-selection-procedure "roulette-selection"
		set add-link-time 10000
		set discount-rate 0.5
		set discrimination-time 10000
		set familiarisation-time 2000
		set max-length-of-episodic-memory 5
		set max-search-iteration 9999
		set number-fixations 4
		set pattern-recognition? true
		set play-time 14400000.0
		set reinforce-actions? true
		set reinforce-problem-solving? true
		set reinforcement-learning-theory "profit_sharing_with_discount_rate" 
		set sight-radius 2
		set time-taken-to-use-pattern-recognition 200
		set time-taken-to-problem-solve 1000
		set visual-spatial-field-access-time 100
		set visual-spatial-field-empty-square-placement-time 10
		set visual-spatial-field-object-movement-time 50
		set visual-spatial-field-object-placement-time 25
		set visual-spatial-field-recognised-object-lifespan 10000
		set visual-spatial-field-unrecognised-object-lifespan 50000
	]
	setup (true)

	create-tiles 1 [setxy ([pxcor] of turtle 0) ( ([pycor] of turtle 0) + 1) ]
	
	let expected-attention-free-time 0
	let expected-visual-spatial-field-construction-value false

	ask turtle 0 [

		generate-plan

		let total-number-patches-visible ( ((sight-radius * 2) + 1) ^ 2 )
		let number-non-empty-patches (count turtles)
		let number-empty-patches (total-number-patches-visible - number-non-empty-patches)
		 
		;When calculating the time taken to encode non-empty squares, 1 is subtracted since
		;the scene creator does not incur an object encoding time cost when the visual-spatial
		;field is constructed.
		set expected-attention-free-time(
			visual-spatial-field-access-time +
			(visual-spatial-field-empty-square-placement-time * number-empty-patches) +
			(visual-spatial-field-object-placement-time * (number-non-empty-patches - 1))
		)

		update-time
		generate-plan

		check-equal (chrest:get-attention-clock) (expected-attention-free-time) ("when checking the attention clock")
		check-equal (construct-visual-spatial-field?) (expected-visual-spatial-field-construction-value) ("when checking the 'construct-visual-spatial-field?' variable")
		check-equal (generate-plan?) (true) ("when checking the 'generate-plan?' variable")
		check-equal (length plan) (0) ("when checking the length of the plan")
		check-equal (time-spent-deliberating-on-plan) (0) ("when checking the time spent deliberating on the plan")
		check-equal (deliberation-finished-time) (0) ("when checking the time deliberation finishes")
		check-equal (current-search-iteration) (0) ("when checking the 'current-search-iteration' turtle variable")
	]
</test>